# Phase 2.5 완료: 선택지 제공 기능

## 📅 완료 날짜
2026-02-20

---

## 🎯 구현 내용

### 1. Description 필드 추가
- **ScreenMetadata에 description 필드 추가**
- 각 화면의 필드 상세 설명 저장
- 키워드 추출 시 description 포함

### 2. 프로젝트/버전 자동 감지
- **detectProject()**: 자연어 → 프로젝트 코드 변환
  - "콘트라베이스" → "CONTRABASS"
  - "sds", "sds플러스" → "SDS+"
  - "비올라" → "VIOLA"
  - "부트", "boot" → "Boot Factory"

- **detectVersion()**: 버전 패턴 감지
  - "3.0.6" 등 X.X.X 패턴 추출

### 3. 검색 전략 자동 선택
```typescript
if (screenId) {
  // 화면 ID 직접 검색
} else if (project && version) {
  // 프로젝트/버전 특정 검색
} else if (project) {
  // 프로젝트 내 전체 버전 검색 (버전별 그룹화)
} else {
  // 전체 프로젝트 검색 (프로젝트/버전별 그룹화)
}
```

### 4. 그룹화된 결과 제공
- **searchGrouped()**: 전체 프로젝트 검색 시 결과 그룹화
- 프로젝트 → 버전 → 화면 계층 구조로 표시

---

## 📊 검색 시나리오 예시

### 시나리오 1: 완전한 정보
```
입력: "콘트라베이스 3.0.6 인스턴스 생성 보안"

결과:
✅ 1개의 화면을 찾았습니다 (자동 확정)
CONT-03_01_16 - 인스턴스_생성_4 (보안)
...
```

### 시나리오 2: 프로젝트만 명시
```
입력: "콘트라베이스 인스턴스 생성 네트워크"

결과:
🔍 "인스턴스 생성 네트워크"로 3개의 화면을 찾았습니다 (CONTRABASS):

📌 버전 3.0.6
   1. CONT-03_01_10 - 인스턴스_생성_3 (세그먼트)
   
📌 버전 3.0.5
   2. CONT-03_01_09 - 인스턴스_생성_3 (네트워크)
   3. CONT-03_01_10 - 인스턴스_생성_3 (네트워크)

어떤 화면을 보시겠습니까? (화면 ID 또는 번호로 선택)
```

### 시나리오 3: 프로젝트/버전 미지정 ⭐
```
입력: "인스턴스 생성 페이지 기획 찾아줘"

결과:
🔍 "인스턴스 생성 페이지 기획"로 15개의 화면을 찾았습니다:

📂 CONTRABASS
   📌 버전 3.0.6
      1. CONT-03_01_10 - 인스턴스_생성_3 (세그먼트)
      2. CONT-03_01_16 - 인스턴스_생성_4 (보안)
      3. CONT-03_01_17 - 인스턴스_생성_5 (완료)
   
   📌 버전 3.0.5
      4. CONT-03_01_10 - 인스턴스_생성_2 (기본정보)
      5. CONT-03_01_11 - 인스턴스_생성_3 (네트워크)

📂 SDS+
   📌 버전 3.0.6
      6. SDS-02_01_05 - 인스턴스 생성 마법사

💡 프로젝트와 버전을 명시하면 더 정확한 결과를 얻을 수 있습니다.
   예: "콘트라베이스 3.0.6 인스턴스 생성 페이지 기획"
```

---

## 🔧 변경된 파일

### 1. `src/services/search.ts`
- `ScreenMetadata` interface에 `description?` 필드 추가
- `GroupedSearchResult` interface 추가
- `calculateScore()`: description을 점수 계산에 포함
  - screenId 매칭: 10점
  - pageTitle 매칭: 8점
  - description 매칭: 5점
  - keywords 매칭: 1-3점
- `searchGrouped()`: 전체 프로젝트 검색 + 그룹화

### 2. `src/tools/search-figma-spec.ts`
- `detectProject()`: 자연어 → 프로젝트 코드 변환
- `detectVersion()`: 버전 패턴 감지
- `searchByProject()`: 프로젝트 내 전체 버전 검색
- `searchAllProjectsGrouped()`: 전체 프로젝트 검색 (그룹화)
- 검색 전략 자동 선택 로직

### 3. `src/scripts/collect-metadata.ts`
- `ScreenMetadata` interface에 `description` 필드 추가
- `extractScreenInfo()`: Description 수집 로직 구현
- `collectDescriptions()`: Description 섹션의 모든 텍스트 수집
- `findNextTextNode()`: 라벨 다음 TEXT 노드 찾기 (state 버그 수정)
- API depth를 5 → 10으로 증가

### 4. `SEARCH_FLOW.md` (신규)
- 자연어 검색 플로우 문서화
- 검색 시나리오별 동작 방식
- 기술 구조 및 알고리즘 설명
- 개선 히스토리 및 향후 계획

---

## 🎯 주요 개선 사항

### Before (v0.1.0)
```
입력: "인스턴스 생성 페이지"
결과: ❌ 검색 결과 없음 (프로젝트/버전 미지정 시 기본값만 검색)
```

### After (v0.2.0)
```
입력: "인스턴스 생성 페이지"
결과: ✅ 모든 프로젝트/버전에서 검색 → 그룹화하여 선택지 제공
```

### 사용자 경험 개선
1. **자동 범위 감지**
   - "콘트라베이스" 입력 → CONTRABASS 프로젝트로 자동 필터
   - "3.0.6" 입력 → 해당 버전으로 자동 필터

2. **계층적 선택지**
   - 프로젝트 → 버전 → 화면 순서로 구조화
   - 사용자가 범위를 좁혀갈 수 있도록 안내

3. **필드 상세 검색**
   - "네트워크 선택", "사용 유형" 등 필드명으로 검색 가능
   - Description에서 해당 필드의 상세 기획 내용 확인

---

## 📈 성능 개선

### 검색 속도
- metadata 인덱스 기반 검색
- 점수 계산 최적화 (description 포함)
- 상위 20개 결과만 반환 (필터링)

### 정확도 향상
- 점수 계산 가중치 조정
  - screenId > pageTitle > description > keywords
- 키워드 매칭 로직 개선

---

## 🚀 다음 단계 (Phase 3)

### 1. 대화형 검색
- 사용자가 선택지에서 번호로 선택 가능
- 다시 질문 기능 ("다시 검색", "더 구체적으로")

### 2. 검색 히스토리
- 최근 검색한 화면 저장
- 빠른 재조회 기능

### 3. 관련 화면 추천
- 같은 메뉴의 다른 스텝 자동 추천
- "이 화면과 관련된 다른 화면"

---

## 📝 테스트 필요

현재 `screen-index.json`에는 pageTitle/description이 "Unknown"으로 되어 있어 **메타데이터 재수집 필요**:

```bash
npm run collect-metadata
```

재수집 후 테스트:
1. "인스턴스 생성 페이지"
2. "콘트라베이스 로드밸런서"
3. "3.0.6 네트워크 세그먼트"
4. "CONT-03_01_16"

---

## 🎉 결론

**자연어 질의에 대한 유연한 검색 지원 완료!**

사용자가 불완전한 정보로 질문해도:
1. 자동으로 프로젝트/버전 감지
2. 적절한 검색 전략 선택
3. 그룹화된 선택지 제공
4. 사용자가 범위를 좁혀갈 수 있도록 안내

이제 **메타데이터 수집**만 완료하면 즉시 사용 가능합니다! 🚀
